(function(e){e.path={};var t={rotate:function(e,t){var n=t*Math.PI/180,r=Math.cos(n),i=Math.sin(n);return[r*e[0]-i*e[1],i*e[0]+r*e[1]]},scale:function(e,t){return[t*e[0],t*e[1]]},add:function(e,t){return[e[0]+t[0],e[1]+t[1]]},minus:function(e,t){return[e[0]-t[0],e[1]-t[1]]}};e.path.bezier=function(n,r){n.start=e.extend({angle:0,length:.3333},n.start);n.end=e.extend({angle:0,length:.3333},n.end);this.p1=[n.start.x,n.start.y];this.p4=[n.end.x,n.end.y];var i=t.minus(this.p4,this.p1),s=t.scale(i,n.start.length),o=t.scale(i,-1),u=t.scale(o,n.end.length);s=t.rotate(s,n.start.angle);this.p2=t.add(this.p1,s);u=t.rotate(u,n.end.angle);this.p3=t.add(this.p4,u);this.f1=function(e){return e*e*e};this.f2=function(e){return 3*e*e*(1-e)};this.f3=function(e){return 3*e*(1-e)*(1-e)};this.f4=function(e){return(1-e)*(1-e)*(1-e)};this.css=function(e){var t=this.f1(e),n=this.f2(e),i=this.f3(e),s=this.f4(e),o={};if(r){o.prevX=this.x;o.prevY=this.y}o.x=this.x=this.p1[0]*t+this.p2[0]*n+this.p3[0]*i+this.p4[0]*s+.5|0;o.y=this.y=this.p1[1]*t+this.p2[1]*n+this.p3[1]*i+this.p4[1]*s+.5|0;o.left=o.x+"px";o.top=o.y+"px";return o}};e.path.arc=function(e,t){for(var n in e){this[n]=e[n]}this.dir=this.dir||1;while(this.start>this.end&&this.dir>0){this.start-=360}while(this.start<this.end&&this.dir<0){this.start+=360}this.css=function(e){var n=(this.start*e+this.end*(1-e))*Math.PI/180,r={};if(t){r.prevX=this.x;r.prevY=this.y}r.x=this.x=Math.sin(n)*this.radius+this.center[0]+.5|0;r.y=this.y=Math.cos(n)*this.radius+this.center[1]+.5|0;r.left=r.x+"px";r.top=r.y+"px";return r}};e.fx.step.path=function(t){var n=t.end.css(1-t.pos);if(n.prevX!=null){e.cssHooks.transform.set(t.elem,"rotate("+Math.atan2(n.prevY-n.y,n.prevX-n.x)+")")}t.elem.style.top=n.top;t.elem.style.left=n.left};e.fn.curve=function(t,n){var r=e.extend({target:"body",trigger:"click",startLength:.1,startAngle:0,endLength:1,endAngle:-30,duration:1e3,parent:".holder",thumb:".thumb",addedDuration:1e3},t);this.each(function(){var t=e(r.parent).find(r.thumb);var i=e(r.target);e(this).on(r.trigger,function(){var s=t.offset();var o=i.offset();var u=t.clone().addClass("moving");e("body").append(u);u.css({position:"absolute",left:s.left,top:s.top});var a={x:s.left,y:s.top,angle:r.startAngle,length:r.startLength};var f={x:o.left,y:o.top,angle:r.endAngle,length:r.endLength};u.animate({path:new e.path.bezier({start:a,end:f})},r.duration,function(){u.remove();n&&n.call(this);i.addClass("added");setTimeout(function(){i.removeClass("added")},r.addedDuration)})})})}})(jQuery)
